# HexStrike AI Service Worker Configuration
name = "unified-hexstrike"
main = "src/hexstrike-worker.js"
compatibility_date = "2025-11-10"
compatibility_flags = ["nodejs_compat"]

# Container configuration
# 映像必須先使用 wrangler containers push 推送到 Cloudflare 容器註冊表
# 執行: bash ./push-dockerhub-to-cloudflare.sh
# 注意：Cloudflare 不允許使用 latest tag，必須使用具體的 digest
[[containers]]
class_name = "HexStrikeContainer"
image = "registry.cloudflare.com/8dfc8c4994bd0925c72ab9e2eff79b48/hexstrike@sha256:0e7e3d631f36a035e5b2178dc89adc2188c1219833bbe6ec17684e06a65881d5"
max_instances = 2

# Durable Objects binding
[[durable_objects.bindings]]
class_name = "HexStrikeContainer"
name = "HEXSTRIKE_CONTAINER"

# Migrations for Durable Objects
[[migrations]]
tag = "v1"
new_sqlite_classes = ["HexStrikeContainer"]

# Environment variables
[vars]
SERVICE_NAME = "hexstrike"
ENVIRONMENT = "production"

# Observability
[observability]
enabled = true

# Workers 配置
workers_dev = true

# 自定義域名配置（需要手動在 Cloudflare Dashboard 設定）
# 或使用 route 替代
# routes = [
#   { pattern = "hexstrike-self.dennisleehappy.org/*", zone_name = "dennisleehappy.org" }
# ]

